(()=>{(function(){function D(e){if(!e||typeof e!="string")return null;let a=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!a)return null;let t=parseInt(a[1],10),i=parseInt(a[2],10)-1,l=parseInt(a[3],10),r=new Date(Date.UTC(t,i,l));return r.getUTCFullYear()===t&&r.getUTCMonth()===i&&r.getUTCDate()===l?r:null}function p(e,a,t){if(!e||isNaN(e.getTime()))return"";let i={timeZone:"UTC"};switch(a){case"locale-short":i.dateStyle="short";break;case"locale-long":i.dateStyle="long";break;case"locale-full":i.dateStyle="full";break;case"locale-medium":default:i.dateStyle="medium";break}try{return new Intl.DateTimeFormat(t,i).format(e)}catch(l){console.error(`Error formatting date with Intl (locale: ${t}, format: ${a}, timezone: UTC):`,l);try{let r={dateStyle:"medium",timeZone:"UTC"};return new Intl.DateTimeFormat(t,r).format(e)}catch(r){console.error(`Error formatting date with fallback Intl (locale: ${t}, timezone: UTC):`,r);let s=e.getUTCFullYear(),o=(e.getUTCMonth()+1).toString().padStart(2,"0"),n=e.getUTCDate().toString().padStart(2,"0");return`${s}-${o}-${n}`}}}function f(e){if(!e||e.hasAttribute("data-tui-datepicker-initialized"))return;e.setAttribute("data-tui-datepicker-initialized","true");let a=e.id,t=e.querySelector("[data-tui-datepicker-display]"),i=a+"-calendar-instance",l=document.getElementById(i),r=a+"-hidden",s=document.getElementById(r),o=l,n=s;if(!l||!s){let d=e.getAttribute("aria-controls"),c=d?document.getElementById(d):null;if(c&&(o||(o=c.querySelector("[data-tui-calendar-container]"))),!n){let u=e.parentElement;u&&(n=u.querySelector("[data-tui-datepicker-hidden-input]"))}}if(!t||!o||!n){console.error("DatePicker init error: Missing required elements.",{datePickerID:a,displaySpan:t,calendar:o,hiddenInput:n});return}let k=e.getAttribute("data-tui-datepicker-display-format")||"locale-medium",I=e.getAttribute("data-tui-datepicker-locale-tag")||"en-US",m=e.getAttribute("data-tui-datepicker-placeholder")||"Select a date",h=d=>{if(!d.detail||!d.detail.date||!(d.detail.date instanceof Date))return;let c=d.detail.date,u=p(c,k,I);t.textContent=u,t.classList.remove("text-muted-foreground");let S=e.closest("[data-tui-popover]")?.querySelector("[data-tui-popover-trigger]");S instanceof HTMLElement?S.click():e.click()},U=()=>{if(n&&n.value){let d=D(n.value);if(d){let c=p(d,k,I);t.textContent.trim()!==c&&(t.textContent=c,t.classList.remove("text-muted-foreground"))}else t.textContent=m,t.classList.add("text-muted-foreground")}else t.textContent=m,t.classList.add("text-muted-foreground")};o.addEventListener("calendar-date-selected",h),U(),e._datePickerInitialized=!0,e._datePickerCleanup=()=>{o&&o.removeEventListener("calendar-date-selected",h)};let C=e.closest("form");C&&C.addEventListener("reset",()=>{n&&(n.value=""),t.textContent=m,t.classList.add("text-muted-foreground")})}function y(e=document){e instanceof Element&&e.matches('[data-tui-datepicker="true"]')&&f(e),e.querySelectorAll('[data-tui-datepicker="true"]:not([data-tui-datepicker-initialized])').forEach(a=>{f(a)})}window.templUI=window.templUI||{},window.templUI.datePicker={init:y},document.addEventListener("DOMContentLoaded",()=>y())})();})();
