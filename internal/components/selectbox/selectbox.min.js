(()=>{(function(){let v=!1;function k(d){if(!d||d.hasAttribute("data-initialized"))return;d.setAttribute("data-initialized","true");let r=d.querySelector("button.select-trigger");if(!r){console.error("Select box: Trigger button (.select-trigger) not found in wrapper",d);return}let m=r.getAttribute("data-tui-selectbox-content-id"),w=r.getAttribute("data-tui-selectbox-multiple")==="true",A=r.getAttribute("data-tui-selectbox-show-pills")==="true",b=m?document.getElementById(m):null,c=r.querySelector(".select-value"),a=r.querySelector('input[type="hidden"]');if(!b||!c||!a){console.error("Select box: Missing required elements for initialization.",{wrapper:d,contentID:m,contentExists:!!b,valueElExists:!!c,hiddenInputExists:!!a});return}r.addEventListener("keydown",e=>{(e.key.length===1||e.key==="Backspace"||e.key==="Delete")&&(e.preventDefault(),document.getElementById(m).click(),setTimeout(()=>{let t=document.querySelector("[data-tui-selectbox-search]");t&&(t.focus(),e.key!=="Backspace"&&e.key!=="Delete"&&(t.value=e.key))},0))});let o=b.cloneNode(!0);b.parentNode.replaceChild(o,b);let y=o.querySelector("[data-tui-selectbox-search]");if(y){let e=()=>{let t=window.getComputedStyle(o);t.display!=="none"&&t.visibility!=="hidden"&&t.opacity!=="0"&&y.focus()};document.addEventListener("click",t=>{r.contains(t.target)&&setTimeout(e,50)}),r.addEventListener("keydown",t=>{(t.key==="Enter"||t.key===" ")&&setTimeout(e,50)}),y.addEventListener("input",t=>{let n=t.target.value.toLowerCase().trim();o.querySelectorAll(".select-item").forEach(s=>{let u=s.querySelector(".select-item-text")?.textContent.toLowerCase()||"",i=s.getAttribute("data-tui-selectbox-value")?.toLowerCase()||"",x=n===""||u.includes(n)||i.includes(n);s.style.display=x?"":"none"})})}o.addEventListener("keydown",e=>{if(e.key==="ArrowDown"||e.key==="ArrowUp"){e.preventDefault();let t=Array.from(o.querySelectorAll(".select-item")).filter(s=>s.style.display!=="none");if(t.length===0)return;let n=o.querySelector(".select-item:focus"),l=0;if(n){let s=t.indexOf(n);e.key==="ArrowDown"?l=(s+1)%t.length:l=(s-1+t.length)%t.length}t[l].focus()}else if(e.key==="Enter"){e.preventDefault();let t=o.querySelector(".select-item:focus");t&&h(t)}else e.key==="Escape"&&(e.preventDefault(),o.querySelector(".select-item:focus")?y.focus():document.activeElement===y&&window.closePopover&&(window.closePopover(m,!0),setTimeout(()=>{r.focus()},50)))});let f=o.querySelectorAll('.select-item[data-tui-selectbox-selected="true"]');if(f.length>0)if(w){if(A){c.innerHTML="";let t=document.createElement("div");t.className="flex flex-nowrap overflow-hidden max-w-full whitespace-nowrap gap-1",Array.from(f).forEach(n=>{let l=document.createElement("div");l.className="flex items-center gap-1 px-2 py-1 text-xs rounded-md bg-primary text-primary-foreground";let s=document.createElement("span");s.textContent=n.querySelector(".select-item-text").textContent;let u=document.createElement("button");u.className="hover:text-destructive focus:outline-none",u.innerHTML="x",u.onclick=i=>{i.stopPropagation(),h(n)},l.appendChild(s),l.appendChild(u),t.appendChild(l)}),c.appendChild(t),c.classList.remove("text-muted-foreground"),setTimeout(()=>{let n=t.scrollWidth,l=c.clientWidth;if(n>l){let u=(r.getAttribute("data-tui-selectbox-selected-count-text")||`${f.length} items selected`).replace("{n}",f.length);c.innerHTML=u,c.classList.remove("text-muted-foreground")}},0)}else c.textContent=`${f.length} items selected`,c.classList.remove("text-muted-foreground");let e=Array.from(f).map(t=>t.getAttribute("data-tui-selectbox-value"));a.value=e.join(",")}else{let e=f[0],t=e.querySelector(".select-item-text");if(t&&(c.textContent=t.textContent,c.classList.remove("text-muted-foreground")),a){let n=e.getAttribute("data-value")||"";a.hasAttribute("data-initialized")||(a.value=n,a.setAttribute("data-initialized","true"),a.dispatchEvent(new Event("change",{bubbles:!0})))}}function C(){o.querySelectorAll(".select-item").forEach(e=>{e.getAttribute("data-tui-selectbox-selected")==="true"?(e.classList.add("bg-accent","text-accent-foreground"),e.classList.remove("bg-muted")):e.classList.remove("bg-accent","text-accent-foreground","bg-muted")})}function h(e){if(!e||e.getAttribute("data-tui-selectbox-disabled")==="true"||v)return;v=!0;let t=e.getAttribute("data-tui-selectbox-value"),n=e.querySelector(".select-item-text");if(w){let l=e.getAttribute("data-tui-selectbox-selected")==="true";if(e.setAttribute("data-tui-selectbox-selected",(!l).toString()),l){e.classList.remove("bg-accent","text-accent-foreground");let i=e.querySelector(".select-check");i&&i.classList.replace("opacity-100","opacity-0")}else{e.classList.add("bg-accent","text-accent-foreground");let i=e.querySelector(".select-check");i&&i.classList.replace("opacity-0","opacity-100")}let s=o.querySelectorAll('.select-item[data-tui-selectbox-selected="true"]');if(s.length>0)if(A){c.innerHTML="";let i=document.createElement("div");i.className="flex flex-nowrap overflow-hidden max-w-full whitespace-nowrap gap-1",Array.from(s).forEach(x=>{let g=document.createElement("div");g.className="flex items-center gap-1 px-2 py-0.5 text-xs rounded-full bg-accent text-accent-foreground";let E=document.createElement("span");E.textContent=x.querySelector(".select-item-text").textContent;let p=document.createElement("button");p.className="hover:text-destructive focus:outline-none",p.innerHTML="\xD7",p.onclick=S=>{S.stopPropagation(),h(x)},g.appendChild(E),g.appendChild(p),i.appendChild(g)}),c.appendChild(i),c.classList.remove("text-muted-foreground"),setTimeout(()=>{let x=i.scrollWidth,g=c.clientWidth;if(x>g){let p=(r.getAttribute("data-tui-selectbox-selected-count-text")||`${s.length} items selected`).replace("{n}",s.length);c.innerHTML=p,c.classList.remove("text-muted-foreground")}},0)}else c.textContent=`${s.length} items selected`,c.classList.remove("text-muted-foreground");else c.textContent=c.getAttribute("data-tui-selectbox-placeholder")||"",c.classList.add("text-muted-foreground");let u=Array.from(s).map(i=>i.getAttribute("data-tui-selectbox-value"));a.value=u.join(","),a.dispatchEvent(new Event("change",{bubbles:!0}))}else{o.querySelectorAll(".select-item").forEach(s=>{s.setAttribute("data-tui-selectbox-selected","false"),s.classList.remove("bg-accent","text-accent-foreground","bg-muted");let u=s.querySelector(".select-check");u&&u.classList.replace("opacity-100","opacity-0")}),e.setAttribute("data-tui-selectbox-selected","true"),e.classList.add("bg-accent","text-accent-foreground");let l=e.querySelector(".select-check");if(l&&l.classList.replace("opacity-0","opacity-100"),c&&n&&(c.textContent=n.textContent,c.classList.remove("text-muted-foreground")),a&&t!==null){let s=a.value;a.value=t,s!==t&&a.dispatchEvent(new Event("change",{bubbles:!0}))}window.closePopover?(window.closePopover(m,!0),setTimeout(()=>{r.focus()},50)):console.warn("closePopover function not found")}setTimeout(()=>{v=!1},100)}o.addEventListener("click",e=>{let t=e.target.closest(".select-item");t&&h(t)}),o.addEventListener("keydown",e=>{let t=e.target.closest(".select-item");t&&(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),h(t))}),o.addEventListener("mouseover",e=>{let t=e.target.closest(".select-item");!t||t.getAttribute("data-tui-selectbox-disabled")==="true"||(o.querySelectorAll(".select-item").forEach(n=>{n.classList.remove("bg-accent","text-accent-foreground","bg-muted")}),t.getAttribute("data-tui-selectbox-selected")!=="true"&&t.classList.add("bg-accent","text-accent-foreground"))}),o.addEventListener("mouseleave",C)}function L(d=document){d.querySelectorAll(".select-container").forEach(k)}window.templUI=window.templUI||{},window.templUI.selectbox={init:L},document.addEventListener("DOMContentLoaded",()=>L())})();})();
